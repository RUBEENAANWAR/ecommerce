<div class="card-header py-3">
  <h5 class="mb-0 mt-2"><b>Billing Details</b></h5>
</div>
<div class="container mt-4 ">
  <div class="row">
    <div class="col-md-8   border border-dark ">
      <form class="mt-4" action="/place-order" id="checkout-form" method="post">
        <!-- 2 column grid layout with text inputs for the first and last names -->
        <div class="mb-4">
          <div class="form-outline">
            <label class="form-label" for=""><b>Name</b></label>

            <input type="text" id="name" name="name" class="form-control border border-dark" />
          </div>
          <!-- Text input -->
          <div class="form-outline mb-4">
            <label class="form-label" for=""><b>Address</b></label>

            <input type="text" id="address" name="address" class="form-control border border-dark" />
          </div>

          <!-- Email input -->
          <div class="form-outline mb-4">
            <label class="form-label" for="pincode"><b>Pin code</b></label>

            <input type="number" id="pincode" name="pincode" class="form-control border border-dark" />
          </div>

          <!-- Number input -->
          <div class="form-outline mb-4">
            <label class="form-label" for="mobile"><b>Mobile</b></label>

            <input type="number" id="mobile" name="mobile" class="form-control border border-dark" />
            <input type="text" name="userId" id="" value="{{user._id}}" hidden>
          </div>
        </div>
      
    </div>


    <div class="col-md-4  border border-dark">
      <div class="card-header py-3 mt-4 ">
        <h5 class="mb-0">Summary</h5>
      </div>
      <div class="card-body">
        <ul class="list-group ">

          <div>
            <strong>Total amount</strong>

          </div>
          <span><strong>Rs.{{total}}</strong></span>
          </li>
        </ul>
        <hr>

        <div class="payment">
          <h5>Payment Method</h5>
          <label class="radio-inline">
            <input type="radio" name="payment-method" value="COD" checked>Cash On Delivery
          </label>
            <br>
          <label class="radio-inline mt-2">
            <input type="radio" name="payment-method" value="ONLINE">Online Payment
          </label>
         <button type="submit" class="btn btn-primary mt-5">Checkout</button>
      
        </div>

      </div>
     
    </div>
   </form>

  </div>
</div>


<script>
  $("#checkout-form").submit((e) => {
    e.preventDefault()
    $.ajax({
      url: '/place-order',
      method: 'post',
      data: $('#checkout-form').serialize(),
      success: (response) => {
        alert(response)
        if(response.codSuccess){
          location.href='/order-success'
        }else{
          razorpayPayment(response)
        }
      }

    })
  })
  function razorpayPayment(order){
    var options = {
    "key": "rzp_test_v9tMjvF4MlbMnH", // Enter the Key ID generated from the Dashboard
    "amount": "order.amount", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
    "currency": "INR",
    "name": "Hips And Hops",
    "description": "Test Transaction",
    "image": "https://example.com/your_logo",
    "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
    "handler": function (response){
       
        verifyPayment(response,order)
    },
    "prefill": {
        "name": "Gaurav Kumar",
        "email": "gaurav.kumar@example.com",
        "contact": "9999999999"
    },
    "notes": {
        "address": "Razorpay Corporate Office"
    },
    "theme": {
        "color": "#3399cc"
    }
};
var rzp1 = new Razorpay(options);
 rzp1.open();

  }
  function verifyPayment(payment,order){
    $.ajax({
      url:'/verify-payment',
      data:{
        payment,
        order
      },
      method:'post',
      success:(response)=>{
        if(response.status){
          location.href='/order-success'
        }else{
          alert('payment failed')
        }
      }
    })
  }
</script>
<style>
  .checkout{
    border:1px solid;
    border-radius: 3px;
    padding: 30px;
  }
  .payment{
    padding-bottom: 16px;
  }
</style>